/*
Built using Kango - Cross-browser extension framework
http://kangoextensions.com/
*/
moarflo_kango.ui.Notification=function(a,b,c,d){this.superclass.apply(this,arguments);this.id=a;this.title=b;this.text=c;this.icon=d;this.tabId=-1};moarflo_kango.ui.Notification.prototype=moarflo_kango.oop.extend(moarflo_kango.ui.NotificationBase,{id:"",title:"",text:"",icon:null,tabId:-1,show:function(){},close:function(){}});
moarflo_kango.ui.Notifications=function(){this.superclass.apply(this,arguments);this._notifications={};this._notificationCounter=0;moarflo_kango.addMessageListener("KangoNotification_show",moarflo_kango.lang.bind(this._onNotificationShow,this));moarflo_kango.addMessageListener("KangoNotification_close",moarflo_kango.lang.bind(this._onNotificationClose,this));moarflo_kango.addMessageListener("KangoNotification_click",moarflo_kango.lang.bind(this._onNotificationClick,this));moarflo_kango.browser.addEventListener(moarflo_kango.browser.event.TAB_REMOVED,moarflo_kango.lang.bind(this._onTabRemoved,
this));moarflo_kango.browser.addEventListener(moarflo_kango.browser.event.DOCUMENT_COMPLETE,moarflo_kango.lang.bind(this._onDocumentComplete,this));moarflo_kango.browser.addEventListener(moarflo_kango.browser.event.BEFORE_NAVIGATE,moarflo_kango.lang.bind(this._onBeforeNavigate,this))};
moarflo_kango.ui.Notifications.prototype=moarflo_kango.oop.extend(moarflo_kango.ui.NotificationsBase,{_notifications:{},_notificationCounter:0,_onNotificationShow:function(a){this._fireNotificationEvent(a.data,moarflo_kango.ui.Notification.prototype.event.Show)},_onNotificationClose:function(a){var b=a.data;this._fireNotificationEvent(b,moarflo_kango.ui.Notification.prototype.event.Close);this._removeNotification(b);a.source.dispatchMessage("KangoNotifications_rearrange")},_onNotificationClick:function(a){this._fireNotificationEvent(a.data,
moarflo_kango.ui.Notification.prototype.event.Click)},_onTabRemoved:function(a){this._removeNotificationForTab(a.tabId)},_onDocumentComplete:function(a){this._removeNotificationForTab(a.target.getId())},_onBeforeNavigate:function(a){this._removeNotificationForTab(a.target.getId())},_getTabById:function(a,b){moarflo_kango.browser.tabs.getAll(function(c){for(var d=0;d<c.length;d++)if(c[d].getId()==a){b(c[d]);return}b(null)})},_removeNotificationForTab:function(a){for(var b=moarflo_kango.object.getKeys(this._notifications),
c=0;c<b.length;c++){var d=b[c];if("undefined"!=typeof this._notifications[d]){var e=this._notifications[d];e.tabId==a&&(e.fireEvent(e.event.Close),this._removeNotification(d))}}},_fireNotificationEvent:function(a,b){var c=this._getNotificationById(a);null!=c&&c.fireEvent(b)},_generateId:function(){return(Math.random()+this._notificationCounter++).toString()},_getNotificationById:function(a){return this._notifications[a]||null},_registerNotification:function(a,b){this._notifications[b]=a},_removeNotification:function(a){delete this._notifications[a]},
_closeNotification:function(a){var b=this._getNotificationById(a);null!=b&&this._getTabById(b.tabId,function(b){null!=b&&b.dispatchMessage("KangoNotifications_close",a)})},_showNotification:function(a){var b=this._getNotificationById(a);null!=b&&moarflo_kango.browser.tabs.getCurrent(function(c){b.tabId=c.getId();var d={id:a,caption:moarflo_kango.getExtensionInfo().name,title:b.title,text:b.text,icon:b.icon};c.dispatchMessage("KangoNotifications_show",d)})},createNotification:function(a,b,c){var d=this,e=this._generateId(),
a=new moarflo_kango.ui.Notification(e,a,b,c);a.show=function(){d._showNotification(e)};a.close=function(){d._closeNotification(e)};this._registerNotification(a,e);return a}});moarflo_kango.NotificationsModule=function(){};moarflo_kango.NotificationsModule.prototype.init=function(){moarflo_kango.ui.notifications=new moarflo_kango.ui.Notifications};"undefined"!=typeof moarflo_kango&&"undefined"!=typeof moarflo_kango.registerModule&&moarflo_kango.registerModule(moarflo_kango.NotificationsModule);
